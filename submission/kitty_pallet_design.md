# Kitten Pallet

## Overview

The kitten pallet adds the ability to create, breed, transfer, sell, and purchase kittens.

## Requirements

The following elements are requirements the kitty pallet MUST implement.

1. Kitten must have a 128 bit DNA, which is randomly generated
2. Kitten must have one owner
3. A user can have zero or more kittens

## Use Cases

The following operations are provided by the kitten pallet.

1. User can create new kittens.
2. User can breed kittens with other kittens so long as they are of opposite sex.
3. User can transfer kitten to another user.
4. User can list kitten for sell.
5. User can remove listings they have placed.
6. User can buy kittens listed for sell.

## Design

The following sections describe the high-level design of the kitties pallet.  

### Calls

/// Create new kitten 
/// Emits: `KittenCreated`  
`fn create`  
* owner: AccountId  

/// Breed two kittens  
/// Emits: `KittenBred` 
/// Emits: `KittenCreated`  
/// Error: `KittenNotOwner` when either kitten does not belong to owner account  
/// Error: `KittenBreedSameSex` when kittens are of same sex  
`fn breed`
* owner: AccountId
* kitten_id_1: KittenId
* kitten_id_2: KittenId

/// Transfers kitten from one account to other account  
/// Error: `KittenNotOwner` when from account does not own kitten  
`fn transfer`
* from_account: AccountId
* kitten_id: KittenId
* to_account: AccountId

/// List kitten for sale  
/// Emits: `KittenListingNew`  
/// Error: `KittenNotOwner` when kitten does not belong to owner account  
/// Error: `KittenAlreadyListed` when kitten has already been listed for sale  
`fn create_listing`
* owner: AccountId
* kitten_id: KittenId
* currency_id: CurrencyId
* amount: Balance

/// Remove an existing kitten for sale listing  
/// Emits: `KittenListingRemoved`  
/// Error: `KittenNotOwner` when kitten does not belong to owner account  
/// Error: `KittenNotListed` when kitten does not have an existing listing  
`fn remove_listing`
* owner: AccountId
* kitten_id: KittenId

/// Purchase a kitten listed for sale  
/// Emits: `KittenPurchased`  
/// Error: `KittenAlreadyOwned` when kitten is already owned by account  
/// Error: `KittenBuyInsufficientBalance` when new owner account does not have enough funds to purchase kitten  
`fn buy_kitten`
* new_owner: AccountId
* kitten_id: KittenId

### Storage
/// Account's kittens  
`Kittens: double_map AccountId, KittenId => Option<Kitten>`  

/// Next kitten identifier  
`NextKittenId: KittenId`

/// Kitten for sale listings  
`Listings: map KittenId => AccountId`  

### Types
`KittenId: u32`

`enum Sex`
* female
* male
  
`struct Kitten`
* id: KittenId
* dna: Hash
* sex: Sex

`Nonce: u64`


### Events

`KittenCreated`  
* owner: AccountId
* kitten_id: KittenId

`KittenTransferred`
* from_account: AccountId
* kitten_id: KittenId
* to_account: AccountId

`KittenBred`
* owner: AccountId
* kitten_id: KittenId

`KittenListingNew`
* owner: AccountId
* kitten_id: KittenId

`KittenListingRemoved`
* owner: AccountId
* kitten_id: KittenId

`KittenPurchased`
* previous_owner: AccountId
* kitten_id: KittenId
* new_owner: AccountId

### Errors
/// Kitten does not belong to owner  
`KittenNotOwner`  

/// Kitten already belongs to owner
`KittenAlreadyOwned`  

/// Kittens of same sex cannot breed  
`KittenBreedSameSex`  

/// Kitten has already been listed for sale  
`KittenAlreadyListed`  

/// Kitten is not listed for sale  
`KittenNotListed`  

/// Account does not have sufficient balance to buy kitten
`KittenBuyInsufficientBalance` 

## Notes and Psudo Code 

### Kitten DNA Random 128 bit Generation
Each kitten MUST have a 128 bit value representing their unique DNA. This unique value SHALL be generated by hashing the combined values of random seed value, the AccountId and a Nonce.

The random seed value SHALL be retrieved by invoking System module `random_seed()`  
The Nonce is an ever increasing value from local storage  

Example:
```
let nonce = <Nonce<T>>::get();
let random_hash = (<system::Module<T>>::random_seed(), &sender, nonce)
                  .using_encoded(<T as system::Trait>::Hashing::hash);
```

